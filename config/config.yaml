# ContentForge AI v2.5 - 内容产出工厂配置
# 定位：批量生成技术内容，不包含发布功能

# ==================== LLM配置 ====================
llm:
  provider: "zhipuai"

  # ZhipuAI配置
  zhipuai:
    api_key: "${ZHIPUAI_API_KEY}"
    base_url: "https://open.bigmodel.cn/api/coding/paas/v4/"
    model: "glm-4.7"
    temperature: 0.7
    max_tokens: 8000
    timeout: 600

    thinking:
      enabled: false
      type: "auto"

# ==================== Agent配置 ====================
agents:
  # ========== 核心Agent（每日简报自动生成） ==========
  # v11.0: 并发数据获取Agent（性能提升10倍，推荐使用）
  concurrent_fetch:
    enabled: true  # 设为true启用并发模式，设为false使用同步模式
    max_concurrent: 10      # 最大并发数（避免被封禁）
    timeout_per_source: 15  # 单个源超时时间（秒）
    retry_failed: true      # 失败是否重试
    max_retries: 2          # 最大重试次数
    rate_limit: 5           # 每秒请求数限制

  # v11.0: 时效性智能加权Agent（确保最新内容优先展示）
  time_weight:
    enabled: true  # 设为true启用时效性加权
    weight_mode: "dynamic"  # dynamic(动态推荐) | linear(线性) | exponential(指数)
    max_hours: 72          # 超过72小时的新闻时效分为0
    boost_latest: 2.0      # 1小时内新闻的加成倍数

  # v11.0: 轻量级事实核查Agent（仅Top10，使用LLM内置知识）
  auto_fact_check:
    enabled: true  # 设为true启用事实核查
    check_top_n: 10        # 仅核查Top10
    use_tavily: false      # 仅使用LLM内置知识（不使用Tavily）
    confidence_threshold: 0.7  # 置信度阈值

  # v11.0: 内容增强Agent（为重要新闻补充背景和影响分析）
  content_enhancer:
    enabled: true  # 设为true启用内容增强
    extract_full_content: true  # 使用trafilatura提取完整内容
    min_importance_score: 70    # 重要性>=70才增强
    enable_background: true     # 生成背景分析
    enable_impact: true         # 生成影响分析

  # v11.0: 翻译精炼Agent（提升中文简报可读性）
  translation_refiner:
    enabled: true  # 设为true启用翻译精炼
    apply_strunk_rules: true    # 应用Strunk原则
    terminology_check: true     # 术语一致性检查
    readability_target: 60      # 目标可读性分数

  # v10.1: AI热点分析Agent（同步模式，向后兼容）
  ai_trend_analyzer:
    enabled: true
    mock_mode: false
    github_publish: false  # 是否自动推送到GitHub（默认关闭）

    # 数据源配置（仅保留工作正常的数据源）
    sources:
      # ========== 顶级科技媒体（工作正常） ==========
      - "techcrunch_ai"      # TechCrunch AI RSS
      - "newsapi"            # NewsAPI.org
      - "hackernews"         # Hacker News API
      - "mit_tech_review"    # MIT Technology Review RSS
      - "openai_blog"        # OpenAI Blog RSS
      # ========== 学术/研究机构（工作正常） ==========
      - "bair_blog"          # Berkeley AI Research Blog (顶级学术)
      - "microsoft_research" # Microsoft Research Blog (官方)
      - "arxiv_news"         # arXiv API
      # ========== AI行业媒体（工作正常） ==========
      - "marktechpost"       # MarkTechPost (AI研究新闻)
      - "kdnuggets"          # KDnuggets (数据科学权威)
      - "ai_business"        # AI Business (行业新闻)
      - "the_gradient"       # The Gradient (AI研究期刊)
      - "infoq_ai"           # InfoQ AI (技术媒体)
      - "hugging_face_blog"  # Hugging Face Blog (官方)
      # ========== 新增实时数据源 (v10.0) ==========
      - "newsdata_io"        # NewsData.io (实时新闻API，秒级更新)
      - "reddit_stream"      # Reddit (实时社区讨论)
      - "github_trending"    # GitHub Trending (开发者关注热点)
      # ========== 新增免费RSS数据源 (v10.1) ==========
      - "ai_news"            # AI News (顶级AI新闻媒体，免费RSS)
      - "the_decoder"        # The Decoder (AI专业新闻，免费RSS)
      - "qbitai"             # 量子位 (中文AI第一媒体，免费RSS)
      - "jiqizhixin"         # 机器之心 (深度AI报道，免费RSS)
      - "wired_ai_v2"        # Wired AI (AI专题新闻，免费RSS)
      - "venturebeat_ai_v2"  # VentureBeat AI (AI商业新闻，免费RSS)
      - "google_ai_blog_v2"  # Google AI Blog (官方AI动态，免费RSS)
      - "deepmind_blog_v2"   # Google DeepMind (顶级研究，免费RSS)
      - "arxiv_cl"           # arXiv NLP (自然语言处理论文，免费RSS)
      - "arxiv_cv"           # arXiv CV (计算机视觉论文，免费RSS)
      - "arxiv_lg"           # arXiv ML (机器学习论文，免费RSS)
      - "reddit_ml_rss"      # Reddit ML (机器学习社区，免费RSS)
      - "reddit_ai_rss"      # Reddit AI (AI讨论社区，免费RSS)
      - "towards_data_science" # Towards Data Science (数据科学文章，免费RSS)

    # 热点配置
    max_trends: 20
    min_heat_score: 60
    cache_ttl: 3600

  # 热点汇总Agent（生成简报）
  trends_digest:
    enabled: true
    style: "magazine"
    include_analysis: true
    max_topics: 20
    temperature: 0.6

  # 新闻评分Agent（v7.0新增，v11.0优化权重）
  news_scoring:
    enabled: true
    max_items: 30  # 最终筛选的新闻数量
    min_per_category: 2  # 每个分类至少保留2条
    max_per_category: 8  # 每个分类最多保留8条

    # 评分权重（总和100）- v11.0优化：提升时效性和质量权重
    scoring_weights:
      source_authority: 25  # 来源权威度（30% → 25%）
      engagement: 15  # 互动数据（20% → 15%）
      freshness: 25  # 时效性（15% → 25%）⬆️
      category_balance: 10  # 分类平衡（15% → 10%）
      content_quality: 15  # 内容质量（10% → 15%）⬆️
      diversity: 5  # 多样性（10% → 5%）
      fact_confidence: 5  # 事实置信度（新增）⬆️

  # 世界顶级简报Agent（v7.0）
  world_class_digest:
    enabled: true
    translate_enabled: true  # 启用翻译
    batch_size: 5  # 批量翻译大小

    # v7.0: 增强功能
    enable_background_analysis: true  # 为重要新闻生成背景分析
    enable_core_insights: true  # 提取核心洞察
    enable_trending_topics: true  # 识别热门话题
    importance_threshold: 70  # 重要性评分阈值，高于此值生成详细分析

    max_items_per_category: 15  # 每个分类最多显示数量（兼容旧版）

  # ========== 内容生成Agent（手动执行） ==========
  # 研究Agent（网络搜索获取技术资料）
  research_agent:
    enabled: true  # 启用，提升长文本质量
    search_provider: "tavily"  # 搜索提供商: zhipuai(推荐,包含在年包中), tavily(付费), mock(离线)
    max_results: 10
    search_depth: "advanced"
    mock_mode: false  # 设为true时不使用任何搜索API

  # 长文本生成Agent（手动：从简报生成长文）
  longform_generator:
    enabled: true  # 启用以生成Series 9和10
    article_length: "long"
    technical_depth: "advanced"
    max_tokens: 8000
    target_word_count: 35000  # 深度技术文章（实际产出30000-40000字符）
    temperature: 0.3  # 降低随机性，提高稳定性

    # 格式修复
    enable_format_fix: true
    remove_duplicate_titles: true
    normalize_headings: true

    # 连贯性
    enable_context_window: true
    max_context_sections: 3

    # 重试配置（Series模式必须生成真实内容）
    max_retries: 3  # 最大重试次数
    retry_delay: 10  # 重试延迟（秒）
    min_word_count: 8000  # 最低字数要求（Series模式）

  # 小红书长笔记Agent（约2000字深度内容）
  xiaohongshu_long_refiner:
    enabled: true
    style: "viral"  # viral（爆款风格）, professional, casual
    target_word_count: 2000  # 目标字数
    max_tokens: 12000  # 长笔记需要更多token
    temperature: 0.95
    include_test_case: true  # 包含亲身实测案例
    use_emotional_language: true

  # 小红书短笔记Agent（500-900字快速阅读）
  xiaohongshu_short_refiner:
    enabled: true
    style: "viral"
    target_word_count: 700  # 目标字数（500-900字范围）
    max_tokens: 4000
    temperature: 0.98  # 更高的创造性
    include_test_case: true

  # Twitter帖子生成Agent（手动：从简报生成为Twitter）
  twitter_generator:
    enabled: true  # 启用专家级Twitter生成
    style: "narrative"  # narrative（叙事型）, data_driven, controversy, tutorial
    thread_mode: true
    max_tweets: 12  # 世界级Thread推荐12条
    max_tokens: 6000
    temperature: 0.98  # 最高创造性
    narrative_structure: "hero_journey"  # hero_journey, problem_solution, before_after
    include_data: true  # 包含数据驱动内容
    cta_intensity: "strong"  # strong, medium, subtle
    use_emojis: true
    hook_strategy: "auto"  # auto, curiosity, controversy, data

  # 微信公众号生成Agent（手动：从简报生成为微信HTML）
  wechat_generator:
    enabled: true  # 启用专家级微信HTML生成
    enable_toc: true  # 生成目录导航
    enable_reading_progress: true  # 显示阅读进度
    enable_share_buttons: true  # 显示分享按钮
    theme: "professional"  # professional, minimal, colorful
    max_tokens: 16000
    temperature: 0.7
    include_seo: true  # 包含SEO优化

  # ========== 质量保证Agent（Phase 1新增） ==========
  # 代码审查Agent
  code_review_agent:
    enabled: true  # 启用，确保代码示例正确性
    languages: ["python", "javascript", "typescript", "java", "go", "rust", "cpp", "c"]
    check_syntax: true  # 检查语法正确性
    check_best_practices: true  # 检查最佳实践
    generate_improvements: true  # 生成改进建议

  # 事实核查Agent
  fact_check_agent:
    enabled: true  # 启用，验证事实声明准确性
    confidence_threshold: 0.8  # 置信度阈值
    max_tavily_calls: 10  # 限制Tavily调用次数（控制成本）
    use_tavily: true  # 是否使用Tavily验证关键声明

  # 质量评估Agent
  quality_evaluator_agent:
    enabled: true  # 启用，综合质量评估
    full_evaluation: true  # 完整评估（6个维度）
    generate_improvement: true  # 生成改进建议
    min_score: 7.0  # 质量达标阈值

  # ========== 一致性检查Agent（Phase 2新增） ==========
  # 一致性检查Agent
  consistency_checker_agent:
    enabled: true  # 启用，确保术语、引用、数据一致性
    use_memory_mcp: false  # 是否使用Memory MCP（暂不启用MCP）
    check_terminology: true  # 检查术语一致性
    check_citations: true  # 检查引用完整性
    check_data: true  # 检查数据一致性

  # ========== 可视化生成Agent（Phase 2新增） ==========
  # 可视化生成Agent
  visualization_generator_agent:
    enabled: true  # 启用，自动生成图表
    generate_mermaid: true  # 生成Mermaid图表代码
    min_diagrams: 3  # 最少生成3个图表

  # ========== 引用格式化Agent（Phase 3新增） ==========
  # 引用格式化Agent
  citation_formatter_agent:
    enabled: true  # 启用，统一引用格式
    citation_style: "gb7714"  # 引用格式: gb7714（GB/T 7714-2015）, apa, ieee
    auto_detect: true  # 自动检测引用类型
    generate_reference_list: true  # 自动生成参考文献列表

  # ========== 辅助Agent（可选，提升质量） ==========
  # 标题优化Agent
  title_optimizer:
    enabled: true  # 启用，提升标题质量
    num_titles: 10
    clickbait_level: 0.3
    use_emojis: true

  # 配图提示词生成Agent
  image_generator:
    enabled: true  # 启用，生成配图提示词
    enable_generation: false  # 仅生成提示词
    provider: "gemini"
    model: "gemini-2.0-flash-exp"
    image_size: "1024x1024"
    num_images: 1

# ==================== 工作流配置 ====================
workflow:
  mode: "sequential"
  run_all_agents: true
  save_intermediate_outputs: true
  output_dir: "data/outputs"
  output_formats:
    - "json"
    - "markdown"

# ==================== 提示词配置 ====================
prompts:
  template_file: "config/prompts.yaml"

# ==================== 日志配置 ====================
logging:
  level: "INFO"
  format: "<green>{time:YYYY-MM-DD HH:mm:ss}</green> | <level>{level: <8}</level> | <cyan>{name}</cyan>:<cyan>{function}</cyan> - <level>{message}</level>"
  file:
    enabled: true
    path: "logs/app.log"
    rotation: "100 MB"
    retention: "30 days"
  console:
    enabled: true

# ==================== 缓存配置 ====================
cache:
  enabled: true
  type: "memory"

# ==================== 数据存储配置 ====================
storage:
  # 每日简报存储
  daily:
    dir: "data/daily"
    format: "json"

  # 系列内容存储
  series:
    dir: "data/series"
    format: "json"

# ==================== 开发模式 ====================
development:
  debug: false
  mock_llm: false
  save_all_states: false
  parallel_execution: false

# ==================== 内容工厂模式配置 ====================
content_factory:
  # 每日自动任务
  daily_auto_mode:
    enabled: false  # 通过crontab控制，不在这里配置
    generate_digest_only: true  # 每日自动只生成简报

  # 手动生成任务
  manual_mode:
    # 从简报生成长文本
    digest_to_longform:
      enabled: true
      select_topic: "auto"  # auto=自动选择最热话题, manual=手动选择

    # 从简报生成小红书
    digest_to_xiaohongshu:
      enabled: true
      select_topic: "auto"

    # 从简报生成Twitter
    digest_to_twitter:
      enabled: true
      select_topic: "auto"
